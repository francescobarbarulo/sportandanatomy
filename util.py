# coding=utf-8

import datetime
import time
from database import Database

class Exercise:
    def __init__(self, data):
        self.data = data
        self.goodness = self.get_goodness()

    def get_goodness(self):
        average_gap = 0
        
        for position in self.data:
            average_gap += abs(position['move'] - position['ideal'])
        
        average_gap /= len(self.data)
        return average_gap < 0.2 # Inserire la soglia per determinare la bontÃ 

		
def get_week_sessions():
    db = Database()
    queryText = '''SELECT *
                   FROM session
                   WHERE WEEK(DATE(timestamp)) = WEEK(CURRENT_DATE)'''
    cursor = db.performQuery(queryText);
    db.closeConnection()
    return cursor

def good_exercises(exercises):
    count = 0
    for exercise in exercises:
        if exercise.goodness:
            count += 1

    return count

# inserimento dati
'''
def insert_rows():
	db = Database()

	real = [1, 0.9999989485, 0.9999966478, 0.9999923713, 0.9999887963, 0.9999844637, 0.9999719538, 0.9999715475, 0.9999647519, 0.999965799, 0.999967696, 0.9999624258, 0.9999565622, 0.9999324122, 0.9998842492, 0.9998468453, 0.999809035, 0.9996874416, 0.9996198302, 0.9994846384, 0.9994449261, 0.9993828263, 0.9993234444, 0.9992075254, 0.999123521, 0.9990448253, 0.9989643084, 0.9988709223, 0.9987771786, 0.9986925132, 0.9985846561, 0.9986226965, 0.9986708126, 0.9987574024, 0.9988468314, 0.9988944431, 0.9989187326, 0.9989812595, 0.99900429, 0.9990457059, 0.9990942673, 0.9991793558, 0.9992329686, 0.9992745349, 0.999243358, 0.9990361352, 0.9983987472, 0.99750216, 0.9954822236, 0.9917334806, 0.9854821151, 0.9549580106, 0.9435545702, 0.9287579412, 0.8886749561, 0.8631163931, 0.8347889538, 0.8057845475, 0.7760012858, 0.7466201469, 0.7175514324, 0.6889241319, 0.6614203144, 0.6363135046, 0.6137033992, 0.593159286, 0.5747388346, 0.5595148958, 0.5465983609, 0.5358123547, 0.5258642008, 0.5163437629, 0.5081102992, 0.4997550777, 0.4930106523, 0.4869612467, 0.4852932795, 0.4884605438, 0.4942744903, 0.4977548484, 0.4956360917, 0.4879828805, 0.4797444527, 0.4723849819, 0.4643415883, 0.4576393488, 0.4536501822, 0.45535257, 0.4613942572, 0.4717119498, 0.4908742375, 0.5193171, 0.5552798055, 0.592915701, 0.6300538602, 0.6658007314, 0.6988121318, 0.7282418845, 0.755420368, 0.8026454056, 0.8204323828, 0.8364517584, 0.8524599162, 0.8671188471, 0.8816489926, 0.8966370464, 0.9116855639, 0.9254126865, 0.9389826059, 0.9511881005, 0.9617651611, 0.9707640984, 0.9781160828, 0.9841584806, 0.9893614801, 0.9938862342, 0.9971046623, 0.9983236894, 0.9984584461, 0.9981978864, 0.9976320657, 0.9968576714, 0.9964099273, 0.9957960879, 0.9952360992, 0.9943910373, 0.993124229, 0.9918654907, 0.9915051668, 0.9913981884, 0.9912053881, 0.9902967869, 0.9899316351, 0.98959608, 0.9920350965, 0.9926809845, 0.9935943913, 0.992484244, 0.990090427, 0.9820856031, 0.97527104, 0.9567236611, 0.9460210547, 0.9227930506, 0.9108091721, 0.8987343117, 0.8865261134, 0.8734400206, 0.8608232694, 0.8486053252, 0.8368728309, 0.8256826845, 0.8160257323, 0.8099276968, 0.8063945739, 0.8038315832, 0.8026091563, 0.8030220486, 0.8031054839, 0.8022341141, 0.8010407281, 0.7999498698, 0.7985092957, 0.7947840818, 0.7891249647, 0.7838618421, 0.778726846, 0.7727470981, 0.7689225991, 0.7664718633, 0.7659619361, 0.7664777919, 0.7673443995, 0.7683678312, 0.7691895804, 0.7684278665, 0.7667610117, 0.7656538449, 0.7640951683, 0.7613401593, 0.7595433964, 0.7577401468, 0.7569869874, 0.7556097841, 0.754063366, 0.751959525, 0.7492997931, 0.7464438872, 0.7427034536, 0.7386822628, 0.7345020611, 0.7304317922, 0.7268393053, 0.7229581955, 0.7191665822, 0.7154884711, 0.7118737517, 0.7084652851, 0.7044112305, 0.7000761911, 0.696147643, 0.6919801884, 0.688154481, 0.6833230221, 0.6787111101, 0.6737355593, 0.6696130255, 0.6640882382, 0.6595807534, 0.6499321471, 0.6468478919, 0.6420916723, 0.6353853673, 0.6287247635, 0.6220467151, 0.6159326775, 0.609752791, 0.6043409719, 0.5995111259, 0.5936215044, 0.5900832763, 0.5859641219, 0.5815400848, 0.5776501327, 0.5756297253, 0.5757672368, 0.5723344271, 0.5674455189, 0.5635616272, 0.5591453907, 0.5536237276, 0.5483060006, 0.5386455003, 0.5347125329, 0.5335097673, 0.5323947331, 0.5301714703, 0.5285097303, 0.5277083093, 0.5273838571, 0.5266238082, 0.5263595192, 0.5259473886, 0.5247679457, 0.5233510454, 0.5228784185, 0.5214573592, 0.5212264358, 0.5218472313, 0.5226743214, 0.5245376736, 0.5269598716, 0.5309416135, 0.5372293167, 0.5444253702, 0.5518899856, 0.5657289814, 0.5703586961, 0.5753489453, 0.5850720702, 0.5906455794, 0.5965641529, 0.6029111633, 0.6092412675, 0.6155133135, 0.6204643377, 0.6249577457, 0.631575111, 0.6375179631, 0.6442987421, 0.6524467311, 0.6595724649, 0.6677132522, 0.6841738529, 0.6916497087, 0.6993373393, 0.7174587779, 0.721384932, 0.7305236434, 0.7338562911, 0.732867029, 0.7347167538, 0.7365866866, 0.7388167421, 0.7415607449, 0.7444770002, 0.7465644386, 0.7490333764, 0.7506218831, 0.7524951167, 0.7541321951, 0.7568126862, 0.7609285118, 0.7650868713, 0.7696296424, 0.7740805162, 0.778841433, 0.7831093253, 0.7876893991, 0.791252737, 0.7945060905, 0.7971538311, 0.7998153353, 0.802112128, 0.8045198532, 0.8073487966, 0.8107095527, 0.8147935222, 0.8196305384, 0.8249167185, 0.8299643914, 0.8403683483, 0.84939586, 0.8538217844, 0.8626485, 0.8667333236, 0.8695168993, 0.8758729303, 0.8815576253, 0.8877076034, 0.8936335103, 0.8969228961, 0.9068215822, 0.909331357, 0.9121438849, 0.9152059844, 0.9222443026, 0.9261953527, 0.9302860625, 0.9335449994, 0.9370627262, 0.9430027124, 0.94631631, 0.9527524453, 0.9553448353, 0.9574270421, 0.9593886333, 0.9610825892, 0.9625161422, 0.9638930505, 0.9657836756, 0.968260487, 0.9697641665, 0.9706052412, 0.9696489664, 0.9678909561, 0.9638625825, 0.9604972465, 0.956649883, 0.9534194144, 0.9519515965, 0.9531740031, 0.9526461785, 0.9526104571, 0.9539189042, 0.9546702499, 0.9552338747, 0.9544203081, 0.9542783944, 0.9547839518, 0.954870467, 0.9543229816, 0.9530961774, 0.9515754028, 0.950762797, 0.9504348378, 0.9497418395, 0.9484744267, 0.9470291713, 0.9445529984, 0.9441070641, 0.9435354332, 0.9427803884, 0.9427112516, 0.9423704632, 0.9424779751, 0.9421475217, 0.9418633057, 0.9414029533, 0.9410456845, 0.9410911292, 0.941253931, 0.9413298359, 0.9422041081, 0.9429743104, 0.9436193677, 0.9442108041, 0.9447075273, 0.9450495797, 0.9452668875, 0.9448604185, 0.9444235435, 0.9437979179, 0.9434494512, 0.9432595467, 0.9431445312, 0.9431219129, 0.9433031657, 0.9432803297, 0.9439665733, 0.9448228062, 0.9448680732, 0.9450829768, 0.9452199862, 0.9450093404, 0.9447261357, 0.9445117284, 0.9441747227, 0.9442175037, 0.9439829806, 0.9441571033, 0.944540566, 0.9444081025, 0.9437818978, 0.9433167109, 0.9429946989, 0.9427576921, 0.9421337203, 0.9413747689, 0.9409860656, 0.9404934041, 0.9402698853, 0.9399513115, 0.9396079538, 0.9388135143, 0.9381496041, 0.9366575554, 0.9358292093, 0.9353555454, 0.9337591014, 0.9332353606, 0.9322935565, 0.9320953068, 0.9320990073, 0.9338407708, 0.9331588781, 0.9335213817, 0.9339297689, 0.9336998923, 0.9327584094, 0.9326996783, 0.9323719062, 0.9323630637, 0.9332103329, 0.933194132, 0.9329017562, 0.9323147952, 0.9311763388, 0.9312103593, 0.9305352964, 0.9302872593, 0.9305916268, 0.9306204179, 0.9311797932, 0.9315657118, 0.931583971, 0.9316581667, 0.9317212424, 0.9318113828, 0.9314612765, 0.9310292238, 0.9304936535, 0.9300009097, 0.9296185253, 0.9296824938, 0.9300831277, 0.9301332117, 0.9311546774, 0.9324475859, 0.9330943644, 0.9333287766, 0.9336260196, 0.9338869721, 0.934393521, 0.935146045, 0.9356315937, 0.9375897848, 0.9380646216, 0.93896904, 0.9394764628, 0.9396260073, 0.9397054771, 0.9400394835, 0.9404042219, 0.9403143055, 0.9404301394, 0.9405521369, 0.9402383972, 0.939648754, 0.9385346422, 0.9382061496, 0.9368520234, 0.9359375974, 0.9354287838, 0.9346632776, 0.9337860558, 0.9330300314, 0.9325139301, 0.9322913293, 0.9328607316, 0.9340080601, 0.9345742878, 0.936133255, 0.9367766064, 0.9373760177, 0.9370768056, 0.9363181371, 0.9365822914, 0.936075427, 0.9360339497, 0.9359376018, 0.9362901331, 0.9365830855, 0.9367202959, 0.9364882226, 0.9361735892, 0.9369373553, 0.9381811391, 0.9386703475, 0.9396654185, 0.9403798389, 0.9411157742, 0.9424348093, 0.9432829039, 0.9443199974, 0.9451658855, 0.9450771033, 0.945275486, 0.9446458511, 0.9440680742, 0.9438343622, 0.9435452748, 0.9438976173, 0.9439692792, 0.9431680518, 0.9430611906, 0.9418013763, 0.9406390381, 0.9402023188, 0.9407060873, 0.9419866941, 0.9423463272, 0.9425048283, 0.9418399779, 0.9414831224, 0.9418046501, 0.9419997643, 0.9419520229, 0.9418252589, 0.9420603845, 0.9428513235, 0.9433703604, 0.9443076942, 0.945551363, 0.9469103349, 0.9475580024, 0.9485814999, 0.9493039637, 0.9502140445, 0.9507807342, 0.9514225502, 0.952148594, 0.9526099851, 0.9532172817, 0.9539034106, 0.9542230213, 0.9539430259, 0.9534275023, 0.9531967796, 0.9527877705, 0.9527453773, 0.9530686188, 0.9535193851, 0.9535713193, 0.9536997928, 0.9532438503, 0.9523043329, 0.9505663207, 0.9488997114, 0.9476252858, 0.9468768185, 0.9465265295, 0.9457455799, 0.946024198, 0.9472434289, 0.9487033695, 0.9499497096, 0.9510156943, 0.9518297223, 0.9520648169, 0.952562477, 0.9527482215, 0.9528441475, 0.953340512, 0.9533203754, 0.9534869522, 0.9538087836, 0.95369738, 0.9537509957, 0.9539996083, 0.9534247667]
	ideal = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.999390827, 0.9975640503, 0.9945218954, 0.9902680687, 0.984807753, 0.9781476007, 0.9702957263, 0.9612616959, 0.9510565163, 0.9396926208, 0.9271838546, 0.9135454576, 0.8987940463, 0.8829475929, 0.8660254038, 0.8480480962, 0.8290375726, 0.8090169944, 0.7880107536, 0.7660444431, 0.7431448255, 0.7193398003, 0.6946583705, 0.6691306064, 0.6427876097, 0.6156614753, 0.5877852523, 0.5591929035, 0.5299192642, 0.5, 0.4694715628, 0.4383711468, 0.4067366431, 0.3746065934, 0.3420201433, 0.3090169944, 0.2756373558, 0.2419218956, 0.2079116908, 0.1736481777, 0.139173101, 0.1045284633, 0.06975647374, 0.0348994967, 0, 0, 0.0348994967, 0.06975647374, 0.1045284633, 0.139173101, 0.1736481777, 0.2079116908, 0.2419218956, 0.2756373558, 0.3090169944, 0.3420201433, 0.3746065934, 0.4067366431, 0.4383711468, 0.4694715628, 0.5, 0.5299192642, 0.5591929035, 0.5877852523, 0.6156614753, 0.6427876097, 0.6691306064, 0.6946583705, 0.7193398003, 0.7431448255, 0.7660444431, 0.7880107536, 0.8090169944, 0.8290375726, 0.8480480962, 0.8660254038, 0.8829475929, 0.8987940463, 0.9135454576, 0.9271838546, 0.9396926208, 0.9510565163, 0.9612616959, 0.9702957263, 0.9781476007, 0.984807753, 0.9902680687, 0.9945218954, 0.9975640503, 0.999390827, 1, 1, 0.999390827, 0.9975640503, 0.9945218954, 0.9902680687, 0.984807753, 0.9781476007, 0.9702957263, 0.9612616959, 0.9510565163, 0.9396926208, 0.9271838546, 0.9135454576, 0.8987940463, 0.8829475929, 0.8660254038, 0.8480480962, 0.8290375726, 0.8090169944, 0.7880107536, 0.7660444431, 0.7431448255, 0.7193398003, 0.7071067812, 0.7009092643, 0.6946583705, 0.6883545757, 0.6819983601, 0.6755902076, 0.6691306064, 0.6626200482, 0.656059029, 0.6494480483, 0.6427876097, 0.6360782203, 0.629320391, 0.6225146366, 0.6156614753, 0.608761429, 0.6018150232, 0.5948227868, 0.5877852523, 0.5807029557, 0.5735764364, 0.5664062369, 0.5591929035, 0.5519369853, 0.544639035, 0.5372996083, 0.5299192642, 0.5224985647, 0.5150380749, 0.507538363, 0.5, 0.4924235601, 0.4848096202, 0.4771587603, 0.4694715628, 0.4617486132, 0.4539904997, 0.4461978131, 0.4383711468, 0.4305110968, 0.4226182617, 0.4146932427, 0.4067366431, 0.3987490689, 0.3907311285, 0.3826834324, 0.3746065934, 0.3665012267, 0.3583679495, 0.3502073813, 0.3420201433, 0.3338068592, 0.3255681545, 0.3173046564, 0.3090169944, 0.3007057995, 0.2923717047, 0.2840153447, 0.2756373558, 0.2672383761, 0.2588190451, 0.2503800041, 0.2419218956, 0.2334453639, 0.2249510543, 0.2164396139, 0.2079116908, 0.1993679344, 0.1908089954, 0.1822355255, 0.1736481777, 0.1650476059, 0.156434465, 0.1478094111, 0.139173101, 0.1305261922, 0.1218693434, 0.1132032138, 0.1045284633, 0.09584575252, 0.08715574275, 0.07845909573, 0.06975647374, 0.06104853953, 0.05233595624, 0.04361938737, 0.0348994967, 0.02617694831, 0.01745240644, 0.008726535498, 0, 0, 0.008726535498, 0.01745240644, 0.02617694831, 0.0348994967, 0.04361938737, 0.05233595624, 0.06104853953, 0.06975647374, 0.07845909573, 0.08715574275, 0.09584575252, 0.1045284633, 0.1132032138, 0.1218693434, 0.1305261922, 0.139173101, 0.1478094111, 0.156434465, 0.1650476059, 0.1736481777, 0.1822355255, 0.1908089954, 0.1993679344, 0.2079116908, 0.2164396139, 0.2249510543, 0.2334453639, 0.2419218956, 0.2503800041, 0.2588190451, 0.2672383761, 0.2756373558, 0.2840153447, 0.2923717047, 0.3007057995, 0.3090169944, 0.3173046564, 0.3255681545, 0.3338068592, 0.3420201433, 0.3502073813, 0.3583679495, 0.3665012267, 0.3746065934, 0.3826834324, 0.3907311285, 0.3987490689, 0.4067366431, 0.4146932427, 0.4226182617, 0.4305110968, 0.4383711468, 0.4461978131, 0.4539904997, 0.4617486132, 0.4694715628, 0.4771587603, 0.4848096202, 0.4924235601, 0.5, 0.507538363, 0.5150380749, 0.5224985647, 0.5299192642, 0.5372996083, 0.544639035, 0.5519369853, 0.5591929035, 0.5664062369, 0.5735764364, 0.5807029557, 0.5877852523, 0.5948227868, 0.6018150232, 0.608761429, 0.6156614753, 0.6225146366, 0.629320391, 0.6360782203, 0.6427876097, 0.6494480483, 0.656059029, 0.6626200482, 0.6691306064, 0.6755902076, 0.6819983601, 0.6883545757, 0.6946583705, 0.7009092643, 0.7071067812, 0.7071067812, 0.7313537016, 0.7547095802, 0.7771459615, 0.79863551, 0.8191520443, 0.8386705679, 0.8571673007, 0.8746197071, 0.8910065242, 0.906307787, 0.9205048535, 0.9335804265, 0.9455185756, 0.956304756, 0.9659258263, 0.9743700648, 0.9816271834, 0.9876883406, 0.9925461516, 0.9961946981, 0.9986295348, 0.9998476952, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
	for i in range(0, len(real)):
		queryText = 'INSERT INTO session(move, ideal) VALUES(%.10f, %.10f)' % (real[i], ideal[i])
		cursor = db.performQuery(queryText);
		time.sleep(0.05);

	db.closeConnection()
    
insert_rows()
'''

result = get_week_sessions().fetchall()
week_exercises = []
i = 0

while i < len(result):

    start = result[i]
    positions = []
    
    while i < len(result) and result[i]['timestamp'] < start['timestamp'] + datetime.timedelta(minutes=2):
        positions.append(result[i])
        i += 1

    week_exercises.append(Exercise(positions))
